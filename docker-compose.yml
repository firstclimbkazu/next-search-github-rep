services:
  nextjs-app:
    build:
      context: ./next-search-github-rep
      dockerfile: ../docker/http/Dockerfile
    ports:
      - "3000:3000"
    # 開発時にはNODE_ENVは自動で'development'になるためコメントアウトします
    environment:
      - NODE_ENV=development
    volumes:
      # ホストのNext.jsソースコードをコンテナの作業ディレクトリ（/appと仮定）にマウントします
      - ./next-search-github-rep:/app
      # ホストのnode_modulesでコンテナ内を上書きしないようにするための設定です
      - /app/node_modules 
    # コンテナ起動時に開発サーバーを起動するコマンドを指定します
    command: sh -c "npm install && npm run dev"

  nginx:
    image: nginx:latest
    ports:
      - "80:80"
    volumes:
      - ./docker/http/nginx.conf:/etc/nginx/nginx.conf:ro # ← ここを修正
    depends_on:
      - nextjs-app
    restart: always
